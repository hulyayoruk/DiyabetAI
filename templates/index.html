<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>DiyabetAI Panel</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-content">
      <h1 class="logo">ğŸ©º DiyabetAI</h1>
      <div class="user-info">
        <p>HoÅŸ geldin, <strong>{{ adsoyad }}</strong> ğŸ‘‹</p>
        <div class="actions">
          <a href="/profil" class="btn-light">Profilim</a>
          <a href="/cikis" class="btn-red">Ã‡Ä±kÄ±ÅŸ Yap</a>
        </div>
      </div>
    </div>
  </header>

  <main class="dashboard">
    <!-- 1. SATIR: SOL BÄ°LGÄ°LER â€” ORTA GRAFÄ°K â€” SAÄ AI -->
    <section class="top-row">
      <!-- Sol kolon (3 kart Ã¼st Ã¼ste) -->
      <div class="top-left-column">
        <div class="card user-card">
          <h3>ğŸ‘¤ KullanÄ±cÄ± Bilgileri</h3>

          <p><strong>Ad Soyad:</strong> {{ adsoyad }}</p>
          <p><strong>Durum:</strong> {{ durum or "BelirtilmemiÅŸ" }}</p>

          <p><strong>TanÄ± Tarihi:</strong>
            {% if tani_tarihi %}
              {{ tani_tarihi.strftime("%d.%m.%Y") if tani_tarihi.__class__.__name__ == "date" else tani_tarihi }}
            {% else %}
              -
            {% endif %}
          </p>

          <p><strong>YaÅŸ:</strong> {{ yas or "BelirtilmemiÅŸ" }}</p>
          <p><strong>Kilo:</strong> {{ kilo or "BelirtilmemiÅŸ" }} kg</p>
          <p><strong>Boy:</strong> {{ boy or "BelirtilmemiÅŸ" }} cm</p>
        </div>

        <div class="card">
          <h3>ğŸ’Š Ä°laÃ§ Bilgileri</h3>
          <p><strong>Ä°laÃ§ Bilgileri:</strong> {{ ilac_bilgileri or "BelirtilmemiÅŸ" }}</p>
          <p>{{ ilac_bilgisi or "Profil sayfasÄ±ndan ilaÃ§ bilgilerini gÃ¼ncelleyebilirsin." }}</p>
        </div>

        <div class="card summary-card">
          <h3>ğŸ“Š Son 24 Saat Ã–zeti</h3>
          <p>Toplam karbonhidrat: <strong id="sum_carbs">-- g</strong></p>
          <p>Egzersiz sÃ¼resi: <strong id="sum_ex">-- dk</strong></p>
          <p>Ortalama ÅŸiddet: <strong id="avg_int">-- / 5</strong></p>
          <p>AdÄ±m sayÄ±sÄ±: <strong id="sum_steps">--</strong></p>
          <p>Uyku sÃ¼resi: <strong id="sum_sleep">-- dk</strong></p>
        </div>
      </div>

      <!-- Orta: Kan ÅŸekeri izleme grafiÄŸi -->
      <div class="top-center-column">
        <div class="card chart-card">
          <div class="chart-card-header">
            <h3>ğŸ“ˆ Kan Åekeri Ä°zleme</h3>
            <span id="glucose-trend-pill" class="trend-pill"></span>
          </div>

          <div class="chart-wrapper">
            <canvas id="glucoseChart"></canvas>
          </div>

          <div class="stats">
            <div>
              <p>AnlÄ±k</p>
              <h4 id="current">
                {% if current_glucose is not none %}
                  {{ current_glucose }} mg/dL
                {% else %}
                  -- mg/dL
                {% endif %}
              </h4>
            </div>
            <div>
              <p>Ortalama</p>
              <h4 id="average">
                {% if average_glucose is not none %}
                  {{ average_glucose }} mg/dL
                {% else %}
                  -- mg/dL
                {% endif %}
              </h4>
            </div>
            <div>
              <p>HbA1c</p>
              {% if hba1c_est is not none %}
                <h4 id="hba1c-value">{{ "%.1f"|format(hba1c_est) }}%</h4>
              {% else %}
                <h4 id="hba1c-value">--%</h4>
              {% endif %}
            </div>
          </div>

          <p class="hba1c-note">
            HbA1c deÄŸeri, ADAG Ã§alÄ±ÅŸmasÄ±ndaki formÃ¼le gÃ¶re
            son Ã¶lÃ§Ã¼mlerin <strong>ortalama kan ÅŸekeri</strong> Ã¼zerinden tahmini
            olarak hesaplanÄ±r; <strong>klinik tanÄ± yerine geÃ§mez.</strong>
          </p>
        </div>
      </div>

      <!-- SaÄŸ: AI Ã–nerileri -->
      <div class="top-right-column">
        <div class="card ai-card">
          <h3>ğŸ¤– AI Ã–nerileri</h3>

          <div class="ai-main red">
            <h4>Risk Analizi</h4>

            <p>
              AnlÄ±k kan ÅŸekeri:
              <strong>
                {% if current_glucose is not none %}
                  {{ current_glucose }} mg/dL
                {% else %}
                  -- mg/dL
                {% endif %}
              </strong>
            </p>

            {% if predicted_glucose is not none %}
              <p>30 dk sonrasÄ± tahmini:
                <strong>{{ predicted_glucose }} mg/dL</strong>
              </p>
            {% else %}
              <p>30 dk sonrasÄ± tahmini:
                <strong>-- mg/dL</strong>
              </p>
            {% endif %}

            <p id="ai-risk-label"><strong>{{ risk }}</strong></p>

            <p id="ai-type-note" class="ai-type-note"></p>
            <p id="ai-risk-desc" class="ai-risk-desc"></p>

            <div id="ai-simulations" class="ai-simulations"></div>

            <p class="disclaimer">
              Bu deÄŸerlendirme bir tÄ±bbi tanÄ± deÄŸildir. Ä°nsÃ¼lin/ilaÃ§ dozunu
              deÄŸiÅŸtirmeden Ã¶nce mutlaka doktoruna danÄ±ÅŸ.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- 2. SATIR: 4 FORM KARTI (tam geniÅŸlik) -->
    <section class="form-row">
      <div class="card form-card">
        <h3>ğŸ©¸ Ã–lÃ§Ã¼m GiriÅŸi</h3>
        <form method="POST" action="/olcum_ekle">
          <label>Kan Åekeri (mg/dL)</label>
          <input type="number" name="glikoz" required>

          <label>Ã–lÃ§Ã¼m Tarihi &amp; Saati</label>
          <input type="datetime-local" name="olcum_zamani">

          <label>Ä°laÃ§</label>
          <input type="text" name="ilac" placeholder="KullanÄ±lan ilaÃ§">

          <label>Not</label>
          <textarea name="notlar" placeholder="Ek bilgi"></textarea>

          <button type="submit" class="btn-blue full-width">Kaydet</button>
        </form>
      </div>

      <div class="card form-card">
        <h3>ğŸ½ï¸ Ã–ÄŸÃ¼n Bilgisi</h3>
        <form method="POST" action="/ogun_ekle">
          <label>Ã–ÄŸÃ¼n ZamanÄ±</label>
          <input type="datetime-local" name="ogun_zaman">

          <label>Ã–ÄŸÃ¼n TÃ¼rÃ¼</label>
          <select name="ogun_turu">
            <option value="">SeÃ§iniz</option>
            <option value="KahvaltÄ±">KahvaltÄ±</option>
            <option value="Ã–ÄŸle">Ã–ÄŸle</option>
            <option value="AkÅŸam">AkÅŸam</option>
            <option value="Ara Ã–ÄŸÃ¼n">Ara Ã–ÄŸÃ¼n</option>
          </select>

          <label>Karbonhidrat (g)</label>
          <input type="number" name="karbonhidrat" min="0" step="1">

          <label>Not</label>
          <textarea name="ogun_not" placeholder="Ã–rn: Pilav, ekmek, meyve..."></textarea>

          <button type="submit" class="btn-blue full-width">Kaydet</button>
        </form>
      </div>

      <div class="card form-card">
        <h3>ğŸƒ Egzersiz Bilgisi</h3>
        <form method="POST" action="/egzersiz_ekle">
          <label>Egzersiz ZamanÄ±</label>
          <input type="datetime-local" name="egzersiz_zaman">

          <label>Egzersiz SÃ¼resi (dk)</label>
          <input type="number" name="egzersiz_suresi" min="0" step="1">

          <label>Egzersiz Åiddeti</label>
          <select name="egzersiz_seviyesi">
            <option value="">SeÃ§iniz</option>
            <option value="1">Ã‡ok hafif</option>
            <option value="2">Hafif</option>
            <option value="3">Orta</option>
            <option value="4">YoÄŸun</option>
            <option value="5">Ã‡ok yoÄŸun</option>
          </select>

          <label>AdÄ±m SayÄ±sÄ±</label>
          <input type="number" name="adim_sayisi" min="0" step="1">

          <label>Not</label>
          <textarea name="egzersiz_not" placeholder="Ã–rn: 20 dk yÃ¼rÃ¼yÃ¼ÅŸ, 10 dk koÅŸu..."></textarea>

          <button type="submit" class="btn-blue full-width">Kaydet</button>
        </form>
      </div>

      <div class="card form-card">
        <h3>ğŸ˜´ Uyku Bilgisi</h3>
        <form method="POST" action="/uyku_ekle">
          <label>Uyku BaÅŸlangÄ±Ã§</label>
          <input type="datetime-local" name="uyku_baslangic">

          <label>Uyku BitiÅŸ</label>
          <input type="datetime-local" name="uyku_bitis">

          <label>Not</label>
          <textarea name="uyku_not" placeholder="Ã–rn: gece uyanma sayÄ±sÄ±..."></textarea>

          <button type="submit" class="btn-blue full-width">Kaydet</button>
        </form>
      </div>
    </section>

    <!-- 3. SATIR: Ã–LÃ‡ÃœM RAPORU (sol geniÅŸ) + DÃ–NEMSEL GLÄ°KOZ (saÄŸ) -->
    <section class="bottom-row">
      <!-- Ã–lÃ§Ã¼m Raporu -->
      <div class="card measurement-card">
        <div class="measurement-header">
          <h3>ğŸ“‹ Ã–lÃ§Ã¼m Raporu</h3>
          <div class="measurement-controls">
            <select id="measurement-range" class="period-select">
              <option value="15">Son 15 gÃ¼n</option>
              <option value="30" selected>Son 30 gÃ¼n</option>
              <option value="90">Son 90 gÃ¼n</option>
            </select>

            <div class="measurement-buttons">
              <button type="button" class="btn-outline" id="btn-export-excel">
                Excel indir
              </button>
              <button type="button" class="btn-outline" id="btn-export-pdf">
                PDF indir
              </button>
            </div>
          </div>
        </div>

        <div class="measurement-table-wrapper">
          <table class="measurement-table">
            <thead>
              <tr>
                <th>Tarih / Saat</th>
                <th>Glikoz (mg/dL)</th>
                <th>Ä°laÃ§</th>
                <th>Not</th>
              </tr>
            </thead>
            <tbody id="measurement-tbody">
              <!-- JS ile dolduruluyor -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- DÃ¶nemsel Glikoz Ã–zeti -->
      <div class="card period-card">
        <div class="period-card-header">
          <h3>ğŸ§  DÃ¶nemsel Glikoz Ã–zeti</h3>
          <select id="period-select" class="period-select">
            <option value="7">Son 7 gÃ¼n</option>
            <option value="15">Son 15 gÃ¼n</option>
            <option value="30">Son 30 gÃ¼n</option>
            <option value="90">Son 90 gÃ¼n</option>
          </select>
        </div>

        <p class="period-main-line">
          Ortalama kan ÅŸekeri:
          <strong id="pr_avg_glucose">--</strong>
        </p>

        <div class="period-chart-wrapper">
          <canvas id="period-chart"></canvas>
        </div>

        <div class="period-grid">
          <div>
            <p>AralÄ±kta (70â€“180)</p>
            <strong id="pr_inrange">--</strong>
          </div>
          <div>
            <p>Hipoglisemi (&lt; 70)</p>
            <strong id="pr_hypo">--</strong>
          </div>
          <div>
            <p>Hiperglisemi (&gt; 180)</p>
            <strong id="pr_hyper">--</strong>
          </div>
        </div>

        <p id="pr_delta" class="period-delta-text"></p>
      </div>
    </section>
  </main>

  <!-- JS -->
  <script src="{{ url_for('static', filename='js/chart.js') }}"></script>
  <script src="{{ url_for('static', filename='js/activity_summary.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ai_suggestions.js') }}"></script>
  <script src="{{ url_for('static', filename='js/period_report.js') }}"></script>
  <script src="{{ url_for('static', filename='js/measurement_report.js') }}"></script>
</body>
</html>
